void 0===tribe.tickets&&(tribe.tickets={}),"undefined"==typeof ajaxurl&&(ajaxurl=TribeTickets.ajaxurl),tribe.tickets.editor={};var ticketHeaderImage=window.ticketHeaderImage||{};!function(e,t,i,n){"use strict";var a=t(document),r=t(document.getElementById("tribetickets"));const c="#rsvp_form_toggle, #ticket_form_toggle, #settings_form_toggle",d=document.body.classList.contains("tec-no-tickets-on-recurring");if(0===r.length)return;var o=t(document.getElementById("event_tickets")),s=t(document.getElementById("post_ID")),l=t(document.getElementById("publish")),_=r.find(".tribe-tickets-editor-blocker"),p=r.find(".spinner"),u=t(document.getElementById("tribe_panel_base")),f=t(document.getElementById("tribe_panel_edit")),m=t(document.getElementById("tribe_panel_settings")),k=["yy-mm-dd","m/d/yy","mm/dd/yy","d/m/yy","dd/mm/yy","m-d-yy","mm-dd-yy","d-m-yy","dd-mm-yy","yy.mm.dd","mm.dd.yy","dd.mm.yy"],b=k[0];n.beforeUnload=function(e){var t=!1;return"true"===u.attr("aria-hidden")&&(t=tribe_global_stock_admin_ui.nav_away_msg),e.returnValue=t,t},ticketHeaderImage={uploader:function(){var e=wp.media({title:HeaderImageData.title,multiple:!1,library:{type:"image"},button:{text:HeaderImageData.button}});return e.on("close",function(){var t=e.state().get("selection").toJSON();t.length&&ticketHeaderImage.render(t[0])}),e.open(),!1},render:function(e){t(document.getElementById("tribe_ticket_header_preview")).html(ticketHeaderImage.imgHTML(e)),t(document.getElementById("tribe_ticket_header_image_id")).val(e.id),t(document.getElementById("tribe_ticket_header_remove")).show(),t(document.getElementById("tribe_tickets_image_preview_filename")).show().find(".filename").text(e.filename)},imgHTML:function(e){var t='<img src="'+e.url+'" ';return t+='width="'+e.width+'" ',t+='height="'+e.height+'" ',t+="/>"}},n.panels={list:"#tribe_panel_base",ticket:"#tribe_panel_edit",settings:"#tribe_panel_settings"},n.swapPanel=function(i){var c;c=i instanceof jQuery?i:void 0!==n.panels[i]?t(n.panels[i]):u;var d=t("#event_tickets");d.trigger("before_panel_swap.tickets",{panel:c}),r.find(".ticket_panel").each(function(){t(this).attr("aria-hidden","true")}),c.attr("aria-hidden","false"),c.is(u)?(t(e).off("beforeunload.tribe"),a.trigger("tribe.dependencies-run")):t(e).on("beforeunload.tribe",n.beforeUnload),d.trigger("after_panel_swap.tickets",{panel:c})},n.fetchPanels=function(e,i){void 0===e&&(e=[]);var a={action:"tribe-ticket-panels",notice:!1,post_id:s.val(),nonce:TribeTickets.add_ticket_nonce,data:e,is_admin:t("body").hasClass("wp-admin")};t.post(ajaxurl,a,function(e){e.success&&n.refreshPanels(e.data,i)},"json")},n.startWatchingMoveLinkIn=function(){o.find(".tribe-ticket-move-link").one("click",function(){e.setTimeout(n.listentToThickboxEvents,250)})},n.listentToThickboxEvents=function(){var e=t("#TB_window");0!==e.length&&e.one("tb_unload",function(){n.fetchPanels(null,"list")})},n.refreshPanels=function(e,i){u=t(e.list),f=t(e.ticket),m=t(e.settings),r.find(n.panels.list).replaceWith(u),r.find(n.panels.ticket).replaceWith(f),r.find(n.panels.settings).replaceWith(m),n.setupPanels(),n.swapPanel(i),t(".tribe-dependency").trigger("verify.dependency")},n.setupPanels=function(){e.MTAccordion({target:".accordion"});var i=t(document.getElementById("tribe-event-datepickers")),n=t(document.getElementById("ticket_start_date")),a=t(document.getElementById("ticket_end_date"));t(document.getElementById("ticket_start_time")),t(document.getElementById("ticket_end_time"));if("undefined"==typeof tribe_datepicker_opts){var c=t("[data-datepicker_format]"),d=c.length?c.attr("data-datepicker_format"):"",o=parseInt(d,10);isNaN(o)||(e.tribe_datepicker_opts={dateFormat:k[o]})}var s,l=e.tribe_datepicker_opts||{};if(i.length&&i.data("startofweek"),"undefined"!=typeof tribe_ticket_datepicker_format){var _=(s=tribe_ticket_datepicker_format.datepicker_format_index,!isNaN(parseFloat(s))&&isFinite(s)?tribe_ticket_datepicker_format.datepicker_format_index:0);b=k[_]}else l&&l.dateFormat&&(b=l.dateFormat);var p={dateFormat:b,showAnim:"fadeIn",changeMonth:!0,changeYear:!0,numberOfMonths:3,showButtonPanel:!1,onChange:function(){},beforeShow:function(e,i){i.input.data("prevDate",i.input.datepicker("getDate"));var n=t(i.dpDiv);n.addClass("tribe-ui-datepicker"),n.attrchange({trackValues:!0,callback:function(e){(e.newValue.indexOf("display: none")>=0||e.newValue.indexOf("display:none")>=0)&&n.removeClass("tribe-ui-datepicker")}})},onSelect:function(e,i){var r=t.datepicker.parseDate(b,e);"ticket_start_date"===i.id?a.datepicker("option","minDate",r):n.datepicker("option","maxDate",r)}};t.extend(p,tribe_l10n_datatables.datepicker);var f=r.find(".tribe-timepicker:not(.ui-timepicker-input)");if(tribe_timepickers.setup_timepickers(f),n.datepicker(p).datepicker("option","defaultDate",t(document.getElementById("EventStartDate")).val()).on("keyup",function(e){8!==e.keyCode&&46!==e.keyCode||t.datepicker._clearDate(this)}),a.datepicker(p).datepicker("option","defaultDate",t(document.getElementById("EventEndDate")).val()).on("keyup",function(e){8!==e.keyCode&&46!==e.keyCode||t.datepicker._clearDate(this)}),t(document.getElementById("tribe_ticket_header_preview")).find("img").length){t(document.getElementById("tribe_ticket_header_remove")).show();var m=t(document.getElementById("tribe_ticket_header_preview")).find("img");m.removeAttr("width").removeAttr("height"),r.width()<m.width()&&m.css("width","95%")}"undefined"!=typeof tribe_event_tickets_plus&&t.isPlainObject(tribe_event_tickets_plus)&&t.isPlainObject(tribe_event_tickets_plus.meta)&&t.isPlainObject(tribe_event_tickets_plus.meta.admin)&&"function"==typeof tribe_event_tickets_plus.meta.admin.init_ticket_fields&&tribe_event_tickets_plus.meta.admin.init_ticket_fields(),tribe.tickets.table&&0!==u.find(".tribe-tickets-editor-table-tickets-body tr").length&&tribe.tickets.table.toggle_sortable(),r.find(tribe.validation.selectors.item).validation(),r.find(".tribe-dependent").dependency(),r.find(".tribe-dependency").trigger("verify.dependency")},a.ajaxSend(function(e,i,n){"string"===t.type(n.data)&&-1!==n.data.indexOf("action=tribe-ticket")&&r.trigger("spin.tribe","start")}),a.ajaxComplete(function(e,i,n){"string"===t.type(n.data)&&-1!==n.data.indexOf("action=tribe-ticket")&&r.trigger("spin.tribe","stop")}),a.on({"spin.tribe":function(e,i){(void 0===i||t.inArray(i,["start","stop"]))&&(i="stop"),"stop"===i?(_.hide(),p.removeClass("is-active")):(_.show(),p.addClass("is-active"))}}),l.on("click",function(i){t(e).off("beforeunload.tribe")}),a.on("click","#settings_form_toggle",function(e){return e.preventDefault(),n.fetchPanels(null,"settings"),!1}),a.on("click","#tribe_settings_form_cancel, #ticket_form_cancel",function(e){return e.preventDefault(),n.fetchPanels(null,"list"),!1}),a.on("click","#tribe_settings_form_save",function(e){e.preventDefault();var t=m.find("input,textarea").serialize();return n.fetchPanels(t,"list"),!1}),a.on("click",".ticket_form_toggle",function(e){return e.preventDefault(),function(e){void 0===e&&(e=!0);var i,n=r.find(".tribe-ticket-editor-field-default_provider");n.is(":radio")&&(n=n.filter(":checked")),i=e?"Tribe__Tickets__RSVP_radio":"Tribe__Tickets_Plus__Commerce__WooCommerce__Main_radio",!e&&n.length>0&&(i=n.val()+"_radio"),t(document.getElementById(i)).prop("checked",!0).trigger("change")}("rsvp_form_toggle"===t(this).attr("id")),f.find(".tribe-dependency").trigger("verify.dependency"),n.swapPanel("ticket"),!1}),a.on("click",".ticket_edit_button",function(e){e.preventDefault();var i=t(this),a={action:"tribe-ticket-edit",post_id:s.val(),ticket_id:i.data("ticketId"),nonce:TribeTickets.edit_ticket_nonce,is_admin:t("body").hasClass("wp-admin")};return t.post(ajaxurl,a,function(t){t.success&&(n.refreshPanels(t.data,"ticket"),n.startWatchingMoveLinkIn("#event_tickets"),r.trigger("edit-ticket.tribe",e))},"json"),!1}),a.on("click.tribe",'[name="ticket_form_save"]',function(e){var i=t(document.getElementById("ticket_form_table")),a=!0;if(i.trigger("validation.tribe"),!tribe.validation.hasErrors(i)&&!1!==(a=r.triggerHandler("additionalValidation.tribe",[a]))){r.trigger("pre-save-ticket.tribe",e);var c=u.find(".tribe-ticket-field-order"),d={action:"tribe-ticket-add",data:f.find("input,textarea,select").serialize().replace(/\'/g,"%27").replace(/\:/g,"%3A"),post_id:s.val(),nonce:TribeTickets.add_ticket_nonce,menu_order:c.length,is_admin:t("body").hasClass("wp-admin")};t.post(ajaxurl,d,function(e){e.success&&n.refreshPanels(e.data)},"json")}}),a.on("click",".ticket_delete",function(e){if(!confirm(tribe_ticket_notices.confirm_alert))return!1;e.preventDefault(),r.trigger("delete-ticket.tribe",e);var i=t(this).attr("attr-ticket-id"),a={action:"tribe-ticket-delete",post_id:s.val(),ticket_id:i,nonce:TribeTickets.remove_ticket_nonce,is_admin:t("body").hasClass("wp-admin")};t.post(ajaxurl,a,function(e){e.success&&n.refreshPanels(e.data)},"json")}),a.on("click",".ticket_duplicate",function(e){e.preventDefault();var i=t(this),a={action:"tribe-ticket-duplicate",post_id:s.val(),ticket_id:i.data("ticketId"),nonce:TribeTickets.duplicate_ticket_nonce,is_admin:t("body").hasClass("wp-admin")};return t.post(ajaxurl,a,function(e){e.success&&n.refreshPanels(e.data)},"json"),!1}),a.on("change",".tribe-ticket-field-capacity",function(e){var i=t(this),n=i.parents(".input_block").eq(0).find(".tribe-ticket-field-mode");i.val()&&n.val("capped")}),a.on("keyup","#ticket_price",function(e){e.preventDefault();var i=price_format.decimal,n=new RegExp("[^-0-9%\\"+i+"]+","gi"),a=t(this).val(),r=a.replace(n,"");a!==r&&t(this).val(r)}),a.on("click","#tribe_ticket_header_image, #tribe_ticket_header_preview",function(e){e.preventDefault(),ticketHeaderImage.uploader("","")}),a.on("focus","#settings_global_capacity_edit",function(){var e=t(this),i=0;t(".tribe-tickets-editor-capacity-table").find("[data-capacity]").each(function(){var e=t(this);i+=parseInt(e.data("capacity"),10)}),e.data("nonSharedCapacity",i)}),a.on("blur change","#settings_global_capacity_edit",function(){var e=t(".tribe-tickets-editor-table-row-capacity-total");if(-1!==parseInt(e.data("totalCapacity"),10)){var n=t(this),a=e.find(".tribe-tickets-editor-total-capacity"),r=parseInt(n.val(),10),c=n.data("nonSharedCapacity");(""===r||0>r||i.isNaN(r))&&(r=0);var d=c+r;a.text(d)}}),a.on("click","#global_capacity_edit_button",function(e){e.preventDefault(),t(document.getElementById("settings_global_capacity_edit")).prop("disabled",!1).focus()}),a.on("blur",'[name="tribe-ticket[event_capacity]"]',function(e,i){void 0===i&&(i=t(this).val());if(void 0!==i){i||(i=0),i=parseInt(i,10);var n=t(".tribe-ticket-capacity-max").find(".tribe-ticket-capacity-value"),a=t('.tribe-ticket-field-capacity[name="tribe-ticket[capacity]"]');a.attr("placeholder",i),i?a.attr("max",i):i=0,n.text(i)}}),a.on("change",'[name="tribe-ticket[capacity]"]',function(e){var i=t(this),n=parseInt(i.attr("max"),10),a=parseInt(i.val(),10);n&&n<a&&i.val(n)}),d&&(a.on("tribe-recurrence-active",function(e){t(c).hide(),t(c).parent().find(".ticket-editor-notice").show()}),a.on("tribe-recurrence-inactive",function(e){t(c).show(),t(c).parent().find(".ticket-editor-notice").hide()}),a.on("tribe-tickets-active",function(e){t(".recurrence-row").hide(),t(".recurrence-row.tribe-recurrence-not-supported").css("visibility","visible").show()}),a.on("tribe-tickets-inactive",function(e){t(".recurrence-row").show(),t(".recurrence-row.tribe-recurrence-not-supported").hide()})),a.on("click","#tribe_ticket_header_remove",function(e){e.preventDefault(),t(document.getElementById("tribe_ticket_header_preview")).html(""),t(document.getElementById("tribe_ticket_header_remove")).hide(),t(document.getElementById("tribe_tickets_image_preview_filename")).hide().find(".filename").text(""),t(document.getElementById("tribe_ticket_header_image_id")).val("")}),a.on("after_panel_swap.tickets",function(){a.trigger("tribe-tickets-active")}),a.on("verify.dependency",function(){t(".tribe-tickets-editor-table-tickets-body").is(":visible")?a.trigger("tribe-tickets-active"):a.trigger("tribe-tickets-inactive"),t(".tribe-event-recurrence-rule").is(":visible")?a.trigger("tribe-recurrence-active"):a.trigger("tribe-recurrence-inactive")}),t(n.setupPanels)}(window,jQuery,_,tribe.tickets.editor);